<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" type="text/css" href="../../css/normalize.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/component.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../../js/eventtable.js"></script>


    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            font: 300 15px/1.5 "Helvetica Neue", helvetica, arial, sans-serif;
            background: #333;
            margin: 15px;
        }

        article {
            width: 100%;
            margin: 0 auto;
            background: #000;
            color: #fff;
            border-radius: 5px;
            box-shadow: 0 0 15px 2px #666;
        }

        section {
            clear: left;
        }

        h1 {
            font-size: 45px;
            font-weight: 100;
            letter-spacing: 15px;
            text-align: center;
        }

        h1, #main_content, #dog_link {
            padding: 15px;
        }

        a {
            color: #06c;

        }

        #main_nav ul {
            background: white;
            float: left;
            -webkit-transition: .5s;
            transition: .5s;
        }

        #main_nav li {
            float: left;
            position: relative;
            width: 200px;
            list-style: none;
            -webkit-transition: .5s;
            transition: .5s;
        }

        #main_nav > ul > li > a, h1 {
            text-transform: uppercase;
        }

        #main_nav a {
            display: block;
            text-decoration: none;
            padding: 5px 15px;
            color: #000;
        }

        #main_nav ul ul {
            position: absolute;
            left: 0;
            top: 100%;
            visibility: hidden;
            opacity: 0;
        }

        #main_nav ul ul ul {
            left: 100%;
            width: 50px;
            top: 0;
        }

        #main_nav ul ul ul ul {
            left: 100%;
            width: 50px;
            top: 0;
        }

        #main_nav li:hover, #main_nav li:hover li {
            background: #ddd;
            visibility: visible;
            opacity: 1;
        }

        #main_nav li li:hover, #main_nav li li:hover li {
            background: #bbb;
            visibility: visible;
            opacity: 1;
        }

        #main_nav li li li:hover, #main_nav li li li:hover li {
            background: #bbb;
            visibility: visible;
            opacity: 1;
        }

        #main_nav li li li input:hover, #main_nav li li li:hover input {
            background: #bbb;
            visibility: visible;
            opacity: 1;
        }

        #main_nav li li li:hover {
            background: #999;
            visibility: visible;
            opacity: 1;
        }

        #main_nav li li li li:hover {
            background: #999;
            visibility: visible;
            opacity: 1;
        }

        #main_nav li:hover > ul {
            visibility: visible;
            opacity: 1;
        }

        input[type=text] {
            width: 130px;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
            background-position: 10px 10px;
            background-repeat: no-repeat;
            padding: 12px 20px 12px 40px;
            -webkit-transition: width 0.4s ease-in-out;
            transition: width 0.4s ease-in-out;
        }

        input[type=text]:focus {
            width: 100%;
        }

    </style>
</head>
<body onload="getList()">
<div class="container demo-2">


    <div class="content">
        <div id="large-header" class="large-header">
            <% include nav %>

            <canvas id="demo-canvas"></canvas>

            <button onclick="displayarrange()"  style="background-color:white;top: 80%; left: 17%; text-align: center; position: absolute; display: block; height: auto; overflow-y: scroll; margin-left:auto; margin-right: auto; font-size: 1.5em;">Arrange events by my location</button>

            <table id="excelDataTable"
                   style="background-color:Black;top: 50%; left: 50%; text-align: center; position: absolute; display: block; height: 300px; overflow-y: scroll; margin-left:auto; margin-right: auto; width: 800px;">

                <tr>
                    <th>Type</th>
                    <th>Event Id</th>
                    <th>Title</th>
                    <th>Distance</th>
                    <th>Time</th>
                    <th>Owner</th>
                <tr/>
                <% for (var i = 0; i < invited_events.length; i++) { %>
                <tr>
                    <td><%= invited_events[i]["type"] %></td>
                    <td><%= invited_events[i]["eventId"] %></td>
                    <td>
                        <a href="/eventMe/event/<%= invited_events[i]["eventId"] %>/<%= user_id%>">
                            <%= invited_events[i]["title"] %>
                        </a>
                    </td>
                    <td id="distance"></td>
                    <p id="user_location"><%= location %></p>
                    <p id="event_location"><%= invited_events[i]["location"] %></p>
                    <script>
                        //-----------Calculate distance between event and user locations---------------
                        var R = 6371e3; // metres
                        var coords=document.getElementById('user_location').innerHTML;
                        /*
                           var latlng=coords.split(',');
                           var lat1=parseFloat(latlng[0].substr(1,latlng[0].length-1));
                           var lon1=parseFloat(latlng[1].substr(1,latlng[1].length));
                        */
                        var lat1=JSON.parse(coords).lat;
                        //window.alert(lat1);
                        var lon1=JSON.parse(coords).lng;
                        //window.alert(lon1);
                        coords=document.getElementById('event_location').innerHTML;
                        var latlng=coords.split(',');
                        var lat2=parseFloat(latlng[0].substr(1,latlng[0].length-1));
                        //window.alert(lat2);
                        var lon2=parseFloat(latlng[1].substr(1,latlng[1].length));
                        //window.alert(lon2);
                        var φ1 = radians(lat1);
                        var φ2 = radians(lat2);
                        var Δφ = radians(lat2-lat1);
                        var Δλ = radians(lon2-lon1);

                        var a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                            Math.cos(φ1) * Math.cos(φ2) *
                            Math.sin(Δλ/2) * Math.sin(Δλ/2);
                        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

                        var d = R * c;
                        document.getElementById('distance').innerHTML=Math.round(d*100)/100+'m';

                        function radians(x)
                        {
                            var pi = Math.PI;
                            return x * (pi/180);
                        }

                    </script>
                    <td><%= invited_events[i]["time"] %></td>
                    <td><%= invited_events[i]["ownerId"] %></td>
                </tr>
                <% } %>
            </table>

        </div>
    </div>
    <!-- Related demos -->
</div><!-- /container -->
<script src="../../js/rAF.js"></script>
<script src="../../js/getstarted.js"></script>

</body>
</html>